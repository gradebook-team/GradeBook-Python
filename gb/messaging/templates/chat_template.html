
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel = 'stylesheet' href = 'https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/css/materialize.min.css'>
<script src = 'https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/js/materialize.min.js'></script>
<link href = 'https://fonts.googleapis.com/icon?family=Material+Icons' rel = 'stylesheet'>

<link rel="stylesheet" href="https://use.typekit.net/rzr6kwp.css">
<link rel = "stylesheet" href = "https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<script src = "https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>

<link rel="stylesheet" href="../static/css/avenir.css">

<script src = '../static/js/emojis.js'></script>
<script src = '../static/js/moment.js'></script>

<style>
    body {
        font-family: "AvenirNextLTW01-Medium";
        font-size: 20px; 

        font-weight: 700;
    }

    .h1{
        font-size: 70px; 
    }

    .h2 {
        font-size: 50px; 
    }

    .h3 {
        font-size: 30px;
    }

    .message-left {
        font-family: "AvenirNextLTW01-Regular", "Segoe UI", "San Francisco", "Roboto";
        font-size: 15px;
        font-weight: 200;

        text-rendering: optimizeLegibility;

        color: white;

        display:inline-block;
        padding: 0 15 0 15px;

        border-radius: 25px 25px 25px 3px;
        margin-bottom: 15px;
        margin-left: 60px;
        margin-top: 15px;

        font-weight: 700;

        max-width: 400px;

        word-wrap: break-word;
    }

    .message-right {

        font-family: "AvenirNextLTW01-Regular", "Segoe UI", "San Francisco", "Roboto";
        font-size: 15px;
        font-weight: 700;
        /*text-rendering: optimizeLegibility;*/

        color: white;

        display:inline-block;
        padding: 0 15 0 15px;

        border-radius: 25px 25px 3px 25px;
        margin-bottom: 15px;

        margin-top: 15px;

        word-wrap: break-word;

        text-align:right;

        max-width: 400px;
    }

    .author {
        font-family: "AvenirNextLTW01-Medium", "Segoe UI", "San Francisco", "Roboto";

        font-size: 12px;
        margin-left: 10px;
        margin-right: 10px;
        margin-top: 20px;
    }

    .left-befor {
        border-bottom-left-radius: 5px;  
    }

    .left-afte {
        border-top-left-radius: 5px;
    }

    .right-befor {
        border-bottom-right-radius: 5px;  
    }

    .right-afte {
        border-top-right-radius: 5px;
    }

    [contenteditable][placeholder]:empty:before {
        content: attr(placeholder);
        color: #bababa;
    }

    .flex-wrap {
        display:flex; 
        flex-wrap: wrap;
    }

    #message-box-content {
        font-family: "AvenirNextLTW01-Medium", "Segoe UI", "San Francisco", "Roboto";
        font-size: 15px;

        font-weight: 600;

        outline: none;
    }

    #send-button {
        background: rgb(30, 80, 220); 
    }

    #send-button:hover {
        cursor: pointer;
        background: rgb(10, 60, 200);
    }

    .utility-icon {
         width: 42px; 
         height: 42px; 

         margin-right: 10px; 
                  
         text-align:center;

         border-radius:50%;

         box-shadow: 0 6px 10px 0 rgba(0,0,0,0.14), 0 1px 18px 0 rgba(0,0,0,0.12), 0 3px 5px -1px rgba(0,0,0,0.3);
         -webkit-box-shadow: 0 6px 10px 0 rgba(0,0,0,0.14), 0 1px 18px 0 rgba(0,0,0,0.12), 0 3px 5px -1px rgba(0,0,0,0.3);
    }

   

   .color-change {
        width: 50px; height: 50px; border-radius: 50%; margin: 12px 10px 0px 10px;
   }

   .color-change:hover {
       opacity: 0.8
   }

    .download {
        width: 15px;
        height: 15px;

        background: rgb(30, 80, 220);
        border-radius: 50%;

        display:inline-block;
    }

    #emojis-box {
        width: 100%; height: 200px;
        background: rgba(200, 200, 200, 0.5);
    }

    .emoji {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;

        cursor: pointer;

        width: 30px;
        height: 30px;

        margin-left: 10px; 
        margin-right: 10px;
        margin-top: 10px;

        transition: all 0.5s
    }

    .emoji:hover {
        margin-left: 7px;
        margin-top: 7px;
        margin-right: 13px;
        font-size: 25px;

    }

    .class-name {
        color: #aaa;

        font-size: 20px;

        margin-left: -10px;
        padding-left: 10px;

        padding-top: 10px;
        padding-bottom: 10px;
    }

    .class-name:hover{
        background: #eee;

        cursor: pointer;
    }

    .action {
        width: fit-content;
        padding: 5px 10px 5px 10px;
        border-radius: 8px;
        color: white;

        margin-top: 5px;
        font-weight: 400;
    }

    .action:hover {
        opacity: 0.8;
        cursor: pointer;
    }

    #change-class-modal {
        transition: top 1s;
    }

    #img-send-modal {
        width: 60%;
        height: 70%;

        position: fixed;

        top:  15%;
        left: 20%;

        z-index: 100000;

        background: white;

        border-radius: 8px;
    }

    .document-photo {
        transition: 1s all;
        cursor: pointer;
    }

    .center-modal {

    }

    .button {
        font-weight: 700;
    }

    .button:hover {
        opacity: 0.9;
    }

    .delete-circle {
        width: 25px;
        height: 25px;

        border-radius: 50%;

        background: #e338;
        border: solid 2px #ee3353;
    }

    .wrapper-metadata-left {
        position: absolute; bottom: -20px; left: 0px;
        
        padding-right: 15px;
        font-size: 12px;

        color: #50506f;

        min-width: 200px;
        width: fit-content;
    }

    .wrapper-metadata-right {
        position: absolute; bottom: -20px; right: 0px;
        
        padding-left: 15px;
        font-size: 12px;

        color: #50506f;

        min-width: 200px;
        width: fit-content;
    }

    .wrapper-author {
        margin-right: 0px;
        font-weight: 700;
    }

    

    .wrapper-profile-left {
        width: 40px;
        height: 40px;

        border-radius: 50%;

        position: absolute;
        object-fit: cover; 
        bottom: 0;
        left: -50px;
    }

    .wrapper-profile-right {
        width: 40px;
        height: 40px;

        border-radius: 50%;

        position: absolute;
        object-fit: cover; 
        bottom: 0;
        right: -50px;
    }

    .hidden {
        display: none;
    }

    .message-image {
        border-radius: 10px;
        max-width: 250px;
    }

    .message-url {
        color: black;
        text-decoration: underline;
        background: white;
        padding: 10px 25px 10px 25px;
        border-radius: 30px;
        margin-bottom: 10px;
    }

    .message-url:hover {
        background: #eee;
    }

    .download-icon {
        margin-left: 10px;
        font-size: 10px;
        padding: 3px;
        vertical-align: baseline;
        border-radius: 50%;
        
        background: black;
        color: white
    }

    ::-webkit-input-placeholder {
        color: #aaa;
    }
    :-moz-placeholder {
        color: #aaa;
    }

    .action-icon {
        cursor: pointer
    }

    .action-icon:hover {
        color: #666 !important;
    }
</style> 

<html>
    <body style = 'padding-left: 50px;padding-top:20px'>

        <div style = 'position: fixed; right: 0; top: 0; width: 350px; height: 100%; background: white; z-index:1; padding-top: 50px; padding-left: 20px; border-color: #ddd'>
                <img src = "../static/gradebook_chat.svg" style = 'width: 200px'>
                <br/><br/>
                <span style = 'font-weight: 700; font-size: 13px'>Class</span>
                <br/>
                <span class = 'title' style = 'color: #50507f; font-size: 25px; overflow-x:scroll'>AP Calc AB (MAA703.1),</span>
                <br/>
                <span id = 'teacher' class = '' style = 'color: #50507f; font-size: 20px'>John Johnson</span>
                <br/><br/>
                <span style = 'font-weight: 700; font-size: 13px'>Classes</span>
                <br/>
                <div>
                    {% for c in class_names %}
                        <div class = 'class-name' style = 'color: #456487'>{{c}}</div>        
                    {% endfor %}
                </div>
        </div>

        <div id = 'messages' style = 'position:fixed; top:00px; left: 20px; padding-left: 0px; margin-top: 20px; padding-right: 70px; width: calc(100% - 350px); height: calc(100% ); overflow-y:scroll; padding-bottom: 300px;'>
            
          <div id = 'm3' style = 'text-align:right; width: 100%'>
                <div id = 'm1-author' class = 'author' style = 'margin-top: 20px'>Kavel Rao</div>
                <div id = 'm2-content' class = 'message-right'><div class = 'download material-icons valign-wrapper' style = 'font-size: 12px'><div style = 'width: 100%; text-align:center'>arrow_downward</div></div> <a href = '#' style = 'color:white'><u>classAssign2.docx</u></a></div>
            </div>
        </div>

        

        <div style = 'position:fixed; bottom:10px; left:20px; min-height: 60px; width:fit-content; '>
                <div id = 'emojis-box' class = 'z-depth-3 hidden' style = 'border-radius: 10px; z-index:2; position: absolute; width: 500px; left: 0px; height: 150px; bottom: calc(100% + 20px); overflow: hidden; background: rgba(255, 255, 255, 0.9)'>
                        <div id = 'emojis-box-content' class = 'flex-wrap' style = 'width: 100%; overflow-y: scroll; position: absolute; top:0; left: 20px; height: 100%;'>
                        </div>
                    </div>
                <div id = 'color-box' class = 'flex-wrap z-depth-3 hidden' style = 'position: absolute; z-index:2;  width: 500px; margin-bottom: 0px; height: 150px; bottom: calc(100% + 20px); background: rgba(255, 255, 255, 0.9); border-radius: 10px; text-align:ceter'>
                        <div class = 'color-change' style = '  background: #0084FF'></div>
                        <div class = 'color-change' style = '  background: #44BEC7'></div>
                        <div class = 'color-change' style = '  background: #FFC300'></div>
                        <div class = 'color-change' style = '  background: #FA3C4C'></div>
                        <div class = 'color-change' style = '  background: #D696BB'></div>
                        <div class = 'color-change' style = '  background: #6699CC'></div>
                        <div class = 'color-change' style = '  background: #FF7E29'></div>
                        <div class = 'color-change' style = '  background: #7646FF'></div>
                        <div class = 'color-change' style = '  background: #20CEF5'></div>
                        <div class = 'color-change' style = '  background: #67B868'></div>
                        <div class = 'color-change' style = '  background: #D4A88C'></div>
                        <div class = 'color-change' style = '  background: #FF5CA1'></div>
                    </div>
            <div style = 'background: #dde; padding: 20px 15px 10px 20px; border-radius: 30px 30px 30px 5px'>
                <div id = 'message-box' class = 'flex-wrap'>
                    <div style = 'background: rgb(50, 100, 240); width: 00px; height: 100px;'></div>
                    <textarea id = 'message-box-content' oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"' class = ' valign-wrapper' style = 'overflow-y: hidden; min-height: 30px; height: fit-content !important;border-style: none; display:inline-block; width: 300px; color: #40405f; margin-right: 10px;height: fit-content; ' placeholder = 'Type a message'></textarea>

                    <i class = 'material-icons action-icon' id = 'attach-button' style = 'color: #aaa; margin-right: 20px; margin-left: 50px'>attach_file</i>
                    
                            <i class = 'material-icons action-icon' id = 'color-button' style = 'color: #aaa; margin-right: 20px'>color_lens</i>
                        
                            <i class = 'material-icons action-icon' style = 'color: #aaa' id = 'emoji-button'>tag_faces</i>

                </div>
            </div>
        </div>

        <div class = 'z-depth-5 hidden' style = '' id = 'img-send-modal'>
            <form action="/file" enctype="multipart/form-data" method="post">
            <div class = 'valign-wrapper' style = 'height:100%; margin-top:0px; margin-left:0px;'>
                <div style = 'width: 100%;'>
                    <input id = 'file-handle' type="text" name="handle" size="40" style = 'display:none;'>
                    <input id = 'file-server' type="text" name="server" size="40" style = 'display:none'>

                    <div class="file-field input-field" style = 'width: 100%'>
                        <div class="valign-wrapper" style = 'width: 50%; margin-left: 25%; height: 60%; background-size: contain; background-position: 50% 50%; background-repeat: no-repeat; -webkit-box-shadow:0; box-shadow:0;'>
                            <div style = 'width: 100%; text-align:center'>

                                <div style = 'width: 200%; margin-left: -50%; height: 100%; position: relative;'>
                                    <div style = 'width: 100%; height: 100%; text-align: center; display:flex; position: absolute; top: 15px; left: 0px'>
                                        <div style = 'width: 150px; margin-left: calc(50% - 75px); padding-top: 30px;'>
                                            <div style = 'width: 150px; margin-right: 20px; position: relative'>
                                                <!--<div style = 'position: absolute; top: -10px; right: -10px' class = 'delete-circle'>
                                                    <i class = 'material-icons' style = 'font-size: 20px; color: #e55'>close</i>
                                                </div>-->
                                                <img src = "../static/document_photos/add_document.svg" style = 'width: 150px; border-radius: 15px;' id = 'add-document' class = 'document-photo z-depth-5'>
                                                <div style = 'margin-top: 25px; color: #aaa; word-break: break-all; width: 500px; margin-left: -175px' id = 'file-name'>Click to upload a file</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <input type="file" name="newfile" id = 'actual-file-input' multiple style = 'width: 100%; height: 60%; display: none; '>

                                <div class="" style = 'width: 100%; text-align: center; margin-top: 50px'>
                                        <span id = 'img-modal-close' class = 'button' style = 'margin-right: 20px; border-radius: 5px; padding: 10px 20px 10px 20px; background: #e62828; color: white; margin-left:
                                        \0px'>Close</span>
                                        <span id = 'img-modal-send' class = 'button' style = 'border-radius: 5px; padding: 10px 20px 10px 20px; background: #15e08c; color: white;  margin-left:
                                        \0px'>Send</span>
                                   
                                </div>
                            </div>
                        </div>
                        
                        <div class="file-path-wrapper" style = 'padding-left: 0 !important; '>
                            <br/>
                            <input class="file-path" placeholder = 'file name' style = 'display: none; padding-left: 20px; color: white !important; background: #000a !important; border-radius: 5px !important; width: 50% !important; margin-left: 10% !important' type="text">
                        </div>
                    </div>
                   

                </div>

            </div>
            
        
            </div>

            </form>

        </div>

        <div style = 'display: none' id = 'token'>{{token}}</div>

    </body>
</html>

<script id = 'global-variables'>
    var showingEmojis = false;
    var showingColors = false;
    var lastAuthor = undefined;
    var username;
    var last_id_received = -1;
    var last_update_id_received = 10000;
    var userColors; 
    var userProfiles;
    
    var currentClassname;
    var currentGetMessageRequest;
    var currentGetUpdateMessageRequest;

    var currentWrapper; 
    var previousMessage;

</script>

<script id = 'global-functions'>
    var socket = io.connect();       // Set the secure flag just in case ;)

    socket.on('connect', function(data){
        console.log(data);
    });

    socket.on("message", function(data){
    console.log("RECIEVED MESSAGE");
    console.log(data);
        insertMessage(rearrangeMessage(data));
    })

    socket.on('color_change', function(data){
        $('.' + data['username']).css('background', data['color']);
    })

    function rearrangeMessage(message){
        message_ = {
            "class" : message['class'],
            "content" : {
                'type' : message['type'],
                'payload' : message['payload']
            },
            'author' : message['username'],    
            'timestamp' : message['timestamp']
        }

        if ('file-name' in message){
            message_['content']['file-name'] = message['file-name']
        }

        return message_
    }

    function getCookie(name){
        var name = name + '=';
        var decodedCookie = decodeURIComponent(document.cookie);

        var ca = decodedCookie.split(";");
        for (var i = 0; i < ca.length; i++){
            var c = ca[i];
            while (c.charAt(0) == ' '){
                c = c.substring(1) 
            }

            if (c.indexOf(name) == 0){
                return c.substring(name.length, c.length); 
            }
        }

        return ""; 
    }

    function sendPlaintext(message){
        var payload = {
            "payload" : message, 
            "type" : "plaintext",
            "class" : currentClassname,
            "class-token" : class_tokens[currentClassname],
            "username" : username, 
            "token" : $('#token').text()
        }
        console.log(payload);
        socket.emit("send", payload)
    };

    function sendFile(){
        var payload = new FormData();
        payload.append("type", "file");
        payload.append("class", currentClassname);
        payload.append("class-token", class_tokens[currentClassname]);
        payload.append("username", username);
        payload.append("token", $('#token').text());
        payload.append("file-name", $('#file-name').val());

        // Add the file
        payload.append("payload", $("#actual-file-input")[0].files[0]);

        // Have to use ajax cuz jquery (to my knowledge) cannot handle FormData very well
        $.ajax({
            url: "/messaging/file",
            data: payload,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function(data) {
                if (data['status'] == 'success'){
                    console.log("file uploaded succesfully")
                }
            }
        });

        $.post(
            "/messaging/file",
            payload,
            function (status, data){
                if (data['status'] == 'success'){
                    console.log("file upload successful");
                }
            }
        )
    }

    function insertMessage(message){
        var message_wrapper_wrapper = $(`<div style = 'width: 100%; text-align: right'>`);

        var message_wrapper;
        
        var timestamp = moment(message['timestamp'] * 1000).fromNow();

        if (message['author'] == username){
            message_wrapper = $(`
            <div style = 'position: relative'>
                <div class = 'wrapper-metadata-left'>
                    <span class = 'wrapper-author'>${message['author']},</span>
                    <span style = '' class = 'wrapper-timestamp' time = ${message['timestamp'] * 1000}>${timestamp}</span>
                </div>
            <img style = '' src = ${userProfiles[message['author']]} class = 'wrapper-profile-left'>
        </div>`);
        }else{
            message_wrapper = $(`
            <div style = 'position: relative'>
                <div class = 'wrapper-metadata-right'>
                    <span class = 'wrapper-author'>${message['author']},</span>
                    <span style = '' class = 'wrapper-timestamp' time = ${message['timestamp'] * 1000}>${timestamp}</span>
                </div>
            <img style = '' src = ${userProfiles[message['author']]} class = 'wrapper-profile-right'>
        </div>`);
        }
        

        message_wrapper.addClass(message['author'])
        message_wrapper.css('background', userColors[message['author']]);

        var new_wrapper = false; 
        var appended_wrapper = false;

        if (!currentWrapper){
            if (message['author'] == username) {
                message_wrapper.addClass("message-left");
            }else{
                message_wrapper_wrapper.append(message_wrapper);
                message_wrapper.addClass("message-right");

                appended_wrapper = true;
            }

            currentWrapper = message_wrapper;
            new_wrapper = true;
        }

        /*        
        var message_author = $('<div>');
        //message_author.attr('id', 'm' + message['id'] + '-author');
        message_author.html(message['author'])
        message_author.addClass("author");

        //message_content.attr('id', 'm' + message['id'] + '-content');
        message_content.html(message['content']['payload']);
        message_content.addClass(message['author']);
        //message_content.addClass("z-depth-4");
        */

        var message_type = message['content']['type'];
        if (message_type === "image"){
            var message_content = $(`
                <div style = "margin: 10px 0px 10px 0px">
                    <img src = ${message['content']['payload']} class = 'message-image'>
                </div>
            `);
        }else if (message_type === 'file'){
            var message_content = $(`
                <div style = "margin: 20px 0px 20px 0px">
                    <a href = ${message['content']['payload']} download = ${message['content']['file-name']} class = 'message-url'>
                        ${message['content']['file-name']}
                        <i class = 'material-icons download-icon' style = ''>arrow_downward</i>
                    </a>
                </div>
            `);
        }else{
            var message_content = $('<div style = "margin: 10px 0px 10px 0px">');

            //message_content.css('background', userColors[message['author']]);
            message_content.text(message['content']['payload']);

        }
        
         if (message['author'] != lastAuthor){
             currentWrapper = message_wrapper;

             if (message['author'] == username) {
                message_wrapper.addClass("message-left");
            }else{
                message_wrapper_wrapper.append(message_wrapper);
                message_wrapper.addClass("message-right");

                appended_wrapper = true;
            }

             new_wrapper = true;

        }else{
            if (message['author'] == username){
                currentWrapper.append(message_content);

            }else{
                currentWrapper.append(message_content);
            }
        }
       
        if (new_wrapper){
            console.log("APPENDING");
            message_wrapper.append(message_content);

            if (appended_wrapper){
                $('#messages').append(message_wrapper_wrapper);
            }else{
                $('#messages').append(message_wrapper);
            }
            lastAuthor = message['author'];

            
        }else{
            // update the timestamp and time attribute
            currentWrapper.find('.wrapper-timestamp').attr("time", message['timestamp'] * 1000).text(timestamp);
        }

            previousMessage = message_content;

        $('#messages').scrollTop($('#messages')[0].scrollHeight);
        
    };

    function insertUpdateMessage(message){
        if (message['type'] == 'color_change'){
            $('.' + message['author']).css('background', message['content']);
            userColors[message['author']] = message['content'];
        }

        last_update_id_received = Math.max(last_update_id_received, message['id']);
    }

    function changeColor(color){
        var payload = {
            "payload" : color, 
            "type" : "color_change",
            "class" : currentClassname,
            "class-token" : class_tokens[currentClassname],
            "username" : username, 
            "token" : $('#token').text()
        }

        socket.emit("color_change", payload)
    }

    function getRecap(){
        $.post(
            "/messaging/recap", 
            {
                "class" : currentClassname
            },
            function (data, status) {
                if (data['status'] == 'success'){
                    for (var message in data['messages']){
                        console.log(data['messages'][message]);
                        insertMessage(JSON.parse(data['messages'][message]));

                        last_update_id_received = data['last_update_id'];
                    }
                }
            }
        )
    ;}

    function getMeta(callback){
        $.post(
            "/messaging/metadata", 
            {
                "class" : currentClassname,
                "class-token" : class_tokens[currentClassname]
            },
            function (data, status) {
                if (data['status'] == 'success'){
                    userColors = data['colors'];
                    userProfiles = data['profiles']
                    callback()

                }
            }
    )
    ;}

    function switchToClass(classname){  // Switch view from one class to another
        previousMessage = undefined;
        lastAuthor = undefined;
        currentWrapper = undefined;

        currentClassname = classname;

        if (currentGetMessageRequest != undefined){
            currentGetMessageRequest.abort();
        }

        if (currentGetUpdateMessageRequest != undefined){
            currentGetUpdateMessageRequest.abort();
        }

        getMeta(getRecap);        // Get colors, its callback is the getRecap, to ensure that a recap is received AFTER we receive the colors

        $('#messages').html('');
        $('.title').text(currentClassname);
    }
</script> 

<script id = 'initialization-step'>
    var class_tokens = {{class_tokens|safe}};

    var colorItems = $(".color-change");
    for (var i = 0; i < colorItems.length; i++){
        $(colorItems[i]).click(function(){
            changeColor($(this).css('background-color'));
        })
    }

    var classnames = $(".class-name");
    for (var i = 0; i < classnames.length; i++){
        $(classnames[i]).click(function(){
            switchToClass($(this).html());
            $('#change-class-modal').css("top", '100%');
            $('.modal-overlay').css('z-index', '-10000');
        });
    }

    // set username
    username = "{{username}}";

    // Populate emojis
    for (var emoji in face_emojis){
        var img = $('<span>');
        img.html(face_emojis[emoji]);
        img.addClass("emoji");

        $('#emojis-box-content').append(img);
    }

    $('.modal').modal({
            endingTop : '0%'
        });
    
    $('#change-class-modal').css("top", '10%');
    $('.modal-overlay').css('z-index', '0');

    switchToClass("{{class_names[0]}}");

</script>

<script id = 'event-listeners'>
    $('body').on("mouseenter", ".document-photo", function(){
        console.log("hovering");
        $(this).removeClass('z-depth-5');
    });

    $('body').on("mouseleave", ".document-photo", function(){
        $(this).addClass('z-depth-5');
    });

    $('body').on("click", ".emoji", function(){
        $('#message-box-content').val($('#message-box-content').val() + $(this).html());
    })

    $('#add-document').click(function(){
        $("#actual-file-input").click();
    });

    // User has selected a file
    $('#actual-file-input').change(function(){
        console.log($(this).val());

        // Change the file-name and also change the add-document photo from an "add-document" to a document

        $('#add-document').attr('src', '../static/document_photos/red.svg');
        $('#file-name').text($(this).val().split('\\').slice(-1)[0]);

    })

    $('#message-box-content').keypress(function(event){
        var key = event.keyCode;

        if (key == 13){
            event.preventDefault();
            console.log($('#message-box-content').val())
            sendPlaintext($('#message-box-content').val(), currentClassname);

            $('#message-box-content').val('');
        }
    });

    $('#attach-button').click(function(){
        $('#img-send-modal').toggleClass('hidden');
    })

    $('#emoji-button').click(function(){
        $("#emojis-box").toggleClass('hidden');
        $('#color-box').addClass('hidden');
    });

     $('#color-button').click(function(){
        $("#color-box").toggleClass('hidden');
        $("#emojis-box").addClass('hidden');
    });

    $('#classroom-change').click(function(){
        $('#change-class-modal').css("top", '10%');
    });

    $('#img-modal-send').click(function(){
        sendFile();
    })

    $('#img-modal-close').click(function(){
        $("#img-send-modal").addClass('hidden');
    })

    setInterval(function (){
        var timestamps = $('.wrapper-timestamp');

        for (var t = 0; t < timestamps.length; t++){
            var timestamp = $(timestamps[t]);
            var time = timestamp.attr('time');

            var updatedTimestamp = moment(time * 1).fromNow();

            timestamp.text(updatedTimestamp);
        }
    }, 5000)

</script>
