<!DOCTYPE html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel = 'stylesheet' href = 'https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/css/materialize.min.css'>
<script src = 'https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/js/materialize.min.js'></script>
<link href = 'https://fonts.googleapis.com/icon?family=Material+Icons' rel = 'stylesheet'>

<link rel="stylesheet" href="https://use.typekit.net/rzr6kwp.css">


<script src = "https://www.jsdelivr.com/package/npm/chart.js?path=dist"></script>
<script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>

<script src="https://use.typekit.net/rzr6kwp.js"></script>
<script>try{Typekit.load({ async: true });}catch(e){}</script>

<link rel="stylesheet" href="../static/css/avenir.css">

<style>
    body {
        color: {{ text_color }};
        font-family: AvenirNextLTW01-Medium, 'Segoe UI', 'Lato', Verdana, sans-serif;
        font-size: 15px;
        font-weight:300;

        text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
    }

    #menu-logo{
         transition:0.5s all ease;
        -webkit-transition:0.5s all ease;
        -moz-transition:all 0.5s ease;
        -o-transition:all 0.5 ease;
    }

    .affix{
        position:fixed;
        top:50;
        left:8;

        width:100%;

        z-index:1;
}

.special-link {
        -webkit-transition: all .5s ease;
        -moz-transitition: all .5s ease;
        -o-transition: all .5s ease;
        transition: all .5s ease;

        color: #B9FDFF;
        font-weight:700;

    }

    .special-link:hover {
        color: rgb(50, 100, 240);
    }



#menu{
    transition:0.5s all ease;
    -webkit-transition:0.5s all ease;
    -moz-transition:all 0.5s ease;
    -o-transition:all 0.5 ease;

    position:fixed;
    top:10; left: 0px;

    z-index:10000;
}

#main-logo{

     transition:4s color, 1s font-size ease;
    -webkit-transition:4s color, 1s font-size ease;
    -moz-transition:color 4s, 1s font-size ease;
    -o-transition:color 4s, 1s font-size ease;

}

.animation-5{
      transition:.5s all ease !important;
    -webkit-transition:.5s all ease !important;
    -moz-transition:all .5s ease !important;
    -o-transition:all .5s ease!important;

}

.page {
        transition:1s top ease !important;
    -webkit-transition:1s top ease !important;
    -moz-transition:top 1s ease !important;
    -o-transition:top 1s ease!important;

}

.colored-a {
    transition:1s color ease;
    -webkit-transition:1s color ease;
    -moz-transition:1s color ease;
    -o-transition:1s color ease;
}

.circle {
    width:12px;
    height:12px;
    border-radius:50%;

    border-style:solid;
    background-color:white;
    border-color:black;

    display:inline-block;

    padding-top:3px;

    text-align:center;

}

.circle-small {
    width:3px;
    height:3px;

    background-color:white;
    display:inline-block;

}

.blur {
    -webkit-filter: blur(2px);-moz-filter: blur(2px);-o-filter: blur(2px);-ms-filter: blur(2px); filter: blur(2px);
}

.h1 {
    font-size:70px;
    font-weight:400;
}

.h2 {
    font-size:30px;
}

.h3 {
    font-size:20px;
}

#forward {

    z-index:1000;
}

#forward:hover{
    cursor:pointer;
}

.shifted{
    left:500px !important;
}

.page {
    position:absolute;
    width:100%;
    height:100%;

    display:flex;
    justify-content:center;
    vertical-align:middle;
    flex-direction:column

}

.page-s{
       transition:0.8s top ease !important;
    -webkit-transition:0.8s top ease !important;
    -moz-transition:top 0.8s ease !important;
    -o-transition:top 0.8s ease!important;

    position:absolute;
    width:100%;
    height:100%;

    display:flex;
    justify-content:center;
    vertical-align:middle;
    flex-direction:column
}

.center-v {
    display:flex;
    justify-content:center;
    vertical-align:middle;
    flex-direction:column
}

.h1-0{
    font-size:0;
}

.margin-50 {
    margin-left:50;
}

.invert-color {
    -webkit-filter: invert(100%);
  filter: invert(100%);
}

.demo-card {

}

.button-a{
     transition:0.2s all ease;
    -webkit-transition:0.2s all ease;
    -moz-transition:all 0.2s ease;
    -o-transition:all 0.2s ease;

    background-color: rgba(0, 0, 0, 0);
    color:white
}

.button-a:hover{
    background-color: rgba(255, 255, 255, .2);
    color:white;
}

 @-webkit-keyframes autofill {
    to {
        color: #aaa;
        background: transparent;
    }
}

input:-webkit-autofill {
    -webkit-animation-name: autofill;
    -webkit-animation-fill-mode: both;
}

.bottom-margin {
    margin-bottom: 20px;
}

.grade {
    padding-top:-3px;
    width: 210px;

     transition:1s all ease !important;
            -webkit-transition:1s all ease !important;
            -moz-transition:all 1s ease !important;
            -o-transition:all 1.5s ease!important;
    background: linear-gradient(to left, rgba(0, 0, 0, 0) 50%, rgb(150, 200, 255) 50%);
            background-size: 200% 100%;
            background-position: 100% bottom;
 
}

.grade:hover{
              background-position: left bottom;

            
}

.profile {
    width:70px;
    height:70px;

    border-radius: 50% ;
}

.line {
    border-bottom: 1px solid black;
    border-top: 0px solid black;
    border-collapse: collapse;
    border-radius:0;
}

th, td {
    min-width: 150px;
    padding-right: 15px;
    border-radius:0;
}

#contact {
    border-style: solid;
    border-width:2px;
    border-radius:30px;
    border-color: rgba(0, 0, 0,0);

    background: #30Fd93;
    padding: 5 10 5 10;
    color:    #000;

}

.point-div {
    display: inline-block;
    width: fit-content;
    min-width: 20px;
    min-height: 20px;
    height: fit-content;
}

.width-200 {
    min-width: 200px;
    padding-right: 20px;
}

.exclude:hover {
    color: #aa3333;
    cursor: pointer;
}

.reset:hover {
    color: #5373da;
    cursor: pointer;
}

#profile-picture-placeholder {
    font-weight: 700 !important;
    color: white !important;
    background:rgba(255, 255, 255, 0.5) !important;

   
    border-radius: 8px !important; 
    padding: 10px 15px 10px 15px !important;

    outline-style: none !important;
    box-shadow: none !important;

    border-bottom-style:none !important;

    width: 70% !important;
    font-size: 25px !important;

    cursor: pointer;
}

.crop-point {
    background: rgba(0, 0, 0, 1);
    border-radius: 50%; 
    width: 20px;
    height: 20px;

    position: absolute; 
}

.crop-boundary {
    background: rgba(0, 0, 0, 0.4);
    position: absolute;
}

#profile-picture-display {
user-select: none;
-moz-user-select: none;
-webkit-user-drag: none;
-webkit-user-select: none;
}

::placeholder { /* Most modern browsers support this now. */
   color:    rgb(56, 45, 56);
}


.menu-item:hover {
    color: #40405f !important;
}


</style>

<html>
    <body style = 'width:100%; background-color: {{ header_color }}; position:relative;'>

        <div id = 'profile-picture-cropper' style = 'display: none; z-index: -1000; position: fixed; width: 700px; height: 600px; top: calc(50% - 300px); left: calc(50% - 350px); background: white; border-radius: 8px;' class = 'z-depth-4'>
            <div style = 'width: 100%; height: 50%; background: #f5f5f5; border-radius: 10px 10px 0px 0px' class = ''>
                <!-- profile picture will be cropped to a 100px x 100px img -->
                <div id = 'select-boundary' style = 'width: 100px; border-width: 2px; border-color: white; border-style: dashed; height: 100px; top: 110px; left: 260px' class = 'crop-boundary'></div>

                <div id = 'select-point-0' p = '0' style = 'top: 100px; left: 250px; border-width: 2px; border-color: white; border-style: solid;' class = 'crop-point'></div>

                <div style = 'width: 100%; height: 100%; background: rgba(255, 255, 255, 0.5); border-radius: 10px 10px 0px 0px; background: url("static/demo_bi.jpg"); background-size: contain; background-repeat: no-repeat; background-position: 50% 50%' id = 'profile-picture-display' class = 'valign-wrapper'>
                    
            </div>
            </div>

            <div style = 'width: 100%; height: 50%; font-weight: 700; padding-left: 50px' class = ''>
                <div style = 'margin-top: 20px; font-size: 40px; font-weight: 700;'>
                    Crop
                </div>
                <div style = 'font-size: 30px; font-weight: 700; width: 70%; margin-bottom: 20px;'>
                    Drag on the black dot to expand the crop or drag on the box to move the crop. 
                </div>
                <span style = 'margin-right: 15px; border-radius: 8px; padding: 15px 40px 15px 40px; background: #ee4444; color: white; font-size: 20px; cursor: pointer' id = 'profile-cancel'>
                        Cancel
                    </span>
                <span style = 'border-radius: 8px; padding: 15px 40px 15px 40px; background: rgb(76, 214, 76); color: white; font-size: 20px; cursor: pointer;' id = 'profile-submit'>
                    Submit
                </span>
            </div>
        </div>

        <div style = 'width:100%; position:relative; height:70px;'>
            <img src = '/static/gradebook.svg' style = 'width:300px; position:absolute; left:10%; top:35px;'>

            <div style = 'position:absolute; right:10%;'>
                <div style = 'margin-left:150px; margin-top:15px; background: url("{{ profile }}"); display:inline-block; background-size: cover; background-repeat:no-repeat; background-position:50% 20%' class = 'profile z-depth-3' ></div>
                        <div style = 'display:inline-block; height:40px;' class= 'valign-wrapper'>
                        </div>
                </div>
                    <div style = 'position:absolute; left: 20px'>
                </div>
            </div>
        </div>

        <div id = 'mnu' style = 'width:20%; height:30px; margin-top: 50px;margin-bottom: 60px; padding-bottom:px; margin-left:10%; font-weight: 700'>
                <table>
                    <tr>
                        <td style = 'min-width: 0'>
                            <div style = 'font-weight:700px; font-size:25px; padding: 5 5 5 5; margin-right: 10px'>
                                <a style = 'color: #ccc; font-weight: 700' href = '/grades' class = 'menu-item'>Grades</a>
                            </div>
                        </td>
                    
                        <td style = 'min-width: 0'>
                            <div style = 'font-weight:700px; font-size:25px; padding: 5 5 5 5; margin-right: 10px' >
                                <a href = '/messaging' style = 'color: #ccc; font-weight: 700' class = 'menu-item'>Chat</a>
                            </div>
                        </td>
                        <td style = 'min-width: 0'>
                            
                            <div style = 'border-radius:0px; font-weight:700px; font-size:25px; padding: 5 5 5 5; border-bottom-style: solid; border-color: #527aff; margin-right: 10px' class = ''>
                                <a href = '#' style = 'color: #527aff; font-weight: 700'>Settings</a>
                            </div>
                        </td>
                        <td style = 'min-width: 0'>
                            <div style = 'font-weight:700px; font-size:25px; padding: 5 5 5 5; margin-right: 10px'>
                                <a style = 'color: rgb(255, 110, 100); font-weight: 700' href = '/logout' class = 'menu-item'>Logout</a>
                            </div>
                        </td>
                    </tr>
                </table>
        </div>
        
        <div id = 'content-wrapper' style = 'z-index:1; width: 100%; padding-bottom:300px;' >
            <div id = 'content' style = 'margin-left: 0px; margin-top:0px; border-radius: 10px; background: {{ bg_color }}; margin-top:8px; width: 80%; margin-left: 10%; padding: 50px 120px 100px 80px; ' class = 'z-depth-3'>
                <div style = 'font-size: 70px'>Settings</div>
                <div id = 'theme-bg' style = 'font-size: 30px; padding: 50px 60px 100px 30px; border-style: solid; border-color: transparent; border-radius: 10px; background: url("static/themes/day.png"); background-size: cover; background-repeat: no-repeat'>
                    <span style = 'font-size: 50px; color: white'>Theme</span>
                    <br/>

                    <span id = 'theme-day' style = 'cursor: pointer; background: #20203f; padding: 10px 50px 10px 50px; border-radius: 8px; color: white'>Day</span>
                    <span id = 'theme-night' style = 'cursor: pointer; color: #20203f; margin-left: 50px;'>Night</span>
                </div>

                <div style = 'display: none; font-size: 30px; margin-top: 20px; padding: 50px 60px 30px 30px; border-style: solid; border-color: transparent; border-radius: 10px; background: #2fce9e; background-size: cover; background-repeat: no-repeat'>
                    <span style = 'font-size: 50px; color: white'>Profile Picture</span>
                    <p style = 'margin-top: 0; font-size: 20px; color: white'>
                        Your profile picture will be displayed on your own pages, and will also act as the photo that appears on GradeBook messenging.
                    </p>

                    <div style = 'display: flex; width: 100%'>
                        <div class = 'profile' style = 'margin-right: 50px; background: white;'>
                            <img class = 'profile' src = '{{profile}}'>
                        </div>
                        
                        <form enctype="multipart/form-data" style = 'width: 100%' action = '/profile' method = 'POST' id = 'profile-picture-form'>
                            <input type = 'text' name = 'change' value = 'profile-photo' id = 'change' style = 'display: none'>

                            <input type = 'text' name = 'crop-x' id = 'crop-x1pos' style = 'display: none'>
                            <input type = 'text' name = 'crop-y' id = 'crop-y1pos' style = 'display: none'>
                            <input type = 'text' name = 'crop-width' id = 'crop-width' style = 'display: none'>

                            <input type="text" id = 'profile-picture-placeholder' placeholder = 'click to upload' readonly = 'readonly'>
                            <input type="file" name = 'profile-picture' id = 'profile-picture' style = 'display: none'>
                        </form>
                    </div>
                </div>

                <div style = 'font-size: 30px; margin-top: 20px; padding: 50px 60px 60px 30px; border-style: solid; border-color: transparent; border-radius: 10px; background: #d43636; background-size: cover; background-repeat: no-repeat'>
                    <div style = 'background: url("static/document_photos/red.svg"); background-repeat: no-repeat; background-position: 100% 50%'>
                        <span style = 'font-size: 50px; color: white'>Delete Account</span>
                        <p style = 'margin-top: 0; font-size: 15px; width: 50%; color: white'>
                            GradeBook collects metadata on its users to both speed up and enhance the user experience. Although the data that we store is very, very safe, there is some sensitive data, so if you do not want this data to be collected, you can opt to delete all information related to your account.
                            <br/><br/>
                            You can always re-establish your account by signing into GradeBook again. For more information on GradeBook's information collection, visit our <a href = '/info/data' style = 'color: white'><span style = 'border-bottom-color: #527aff; border-bottom-style: solid'>info page</span></a>.
                        </p>

                        <br/>

                        <span style = 'cursor: pointer; background: white; color: #f33; padding: 20px 60px 20px 60px; font-size: 30px; font-weight: 700; border-radius: 8px;' id = 'delete-account'>
                            Delete
                        </span>

                        <form style = 'display:none' action = '/delete' method = 'POST' id = 'delete-account-form'>

                        </form>
                    </div>
                </div>
            </div>

            

           
        </div>

    
        <div style = 'position: absolute; left:0; bottom: 0px; width: 100%; text-align: center; color: white; font-size: 12px; padding: 20px 10px 15px 10px; '>
                <span style = 'padding: 5px 15px 5px 15px; background: #527aff55; color: #527aff; border-radius: 5px;'><span style = 'font-size: 12px;'>&copy</span> 2017-2018 Nathan Yan</span>
                
                <span style = 'padding: 5px 15px 5px 15px; background: #527aff55; color: #527aff; border-radius: 5px;'>served by {{server_name}}</span>
            </div>


        </div>
    </body>
</html>

<script>
    var current_settings = {{parsed_settings|safe}};

    if (current_settings['theme'] == 'night'){
        $("#theme-bg").css('background', 'url("static/themes/night.png")')
        $("#theme-bg").css('background-size', 'cover')
        $("#theme-bg").css('background-repeat', 'no-repeat')

        $("#theme-night").attr('style', 'cursor: pointer; background: #20203f; padding: 10px 50px 10px 50px; border-radius: 8px; color: white; margin-left: 50px');
        $("#theme-day").attr('style', 'cursor: pointer; color: #51CEEE; ');

    }

    $("#theme-day").click(function(){
        $.post(
            "/profile",
            {
                "change" : "theme",
                "value" : "day"
            },
            function (data){
                location.reload();  // Reload the page so that any updates are made. It's kinda lazy but it works
            }
        )
    })

    $("#theme-night").click(function(){
        $.post(
            "/profile",
            {
                "change" : "theme",
                "value" : "night"
            },
            function (data){
                location.reload();  // Reload the page so that any updates are made. It's kinda lazy but it works
            }
        )
    })


    $('#profile-picture-placeholder').click(function(){
        $("#profile-picture").click();
    })

    var draggingCropPoint = false;
    var draggingBoundary = false;

    var initialSelectX = 360;
    var initialSelectY = 210;

    var initialSelectTempX = 360;
    var initialSelectTempY = 210;

    var startDragX;
    var startDragY;

    $(".crop-point").mousedown(function() {
        draggingCropPoint = $(this);
        draggingBoundary = false;
        console.log("dragging")
    })

    $(".crop-boundary").mousedown(function(e) {
        draggingCropPoint = false;
        draggingBoundary = $(this);
        console.log("dragging");

        startDragX = e.pageX;
        startDragY = e.pageY; 
    })

    function clamp(v, min, max){
        if (v > max){return max}
        else if (v < min){return min}

        return v
    }

    $(document).mousemove(function(e) {
        if (draggingCropPoint){
            var x = e.pageX 
            var y = e.pageY;

            var docHeight = $(window).height();
            var docWidth = $(window).width();

            var startX = docWidth * 0.5 - 350;
            var startY = docHeight * 0.5 - 300;

            var relativeX = x - startX;
            var relativeY = y - startY;

            var distanceX = (initialSelectX - relativeX);
            var distanceY = (initialSelectY - relativeY);

            distanceX = Math.max(distanceX, distanceY);
            console.log(relativeY + ", " + distanceX);

            // Now we'll perform various checks to ensure the crop window is proper
            // This is so that the crop cannot be shrunk below a certain size
            if (distanceX > 50 && (relativeY + distanceX < 300)){
                // Top must be 0 < TOP < 300 (300 because the image window only takes up half the height)
                // left must be 0 < LEFT < 700

                $("#select-boundary").css('width', distanceX + 'px');
                $("#select-boundary").css('height', distanceX + 'px');

                $("#select-boundary").css('top', clamp(initialSelectY - distanceX, 0, 300 - distanceX) + 'px');
                $("#select-boundary").css('left', clamp(initialSelectX - distanceX, 0, 700 - distanceX) + 'px');

                draggingCropPoint.css('left', clamp(initialSelectX - distanceX - 10, -10, 690) + 'px');
                draggingCropPoint.css('top', clamp(initialSelectY - distanceX - 10, -10, 290) + 'px');
            }

        }else if (draggingBoundary){
            var offsetX = e.pageX - startDragX;
            var offsetY = e.pageY - startDragY;

            initialSelectTempX = initialSelectX + offsetX;
            initialSelectTempY = initialSelectY + offsetY;

            var width = $("#select-boundary").width();

            $("#select-boundary").css('top', clamp(initialSelectTempY - width, 0, 300 - width) + 'px');
            $("#select-boundary").css('left', clamp(initialSelectTempX - width, 0, 700 - width) + 'px');

            $('#select-point-0').css('top', clamp(initialSelectTempY - width - 10, -10, 290 - width) + 'px');
            $('#select-point-0').css('left', clamp(initialSelectTempX - width - 10, -10, 690 - width) + 'px');
        }
    })

    $(document).mouseup(function() {
        console.log("mouseUP");
        draggingCropPoint = false;
        draggingBoundary = false;

        initialSelectX = initialSelectTempX;
        initialSelectY = initialSelectTempY;

        var width = $("#select-boundary").width();

        $('#select-point-0').css('top', initialSelectY - width - 10 + 'px');
        $('#select-point-0').css('left', initialSelectX - width - 10 + 'px');
    });

    $('#profile-submit').click(function (){
        var x = $('#select-point-0').css('left');
        var y = $('#select-point-0').css('top');
        var width = $("#select-boundary").width();

        $('#crop-x1pos').val(x);
        $('#crop-y1pos').val(x);
        $('#crop-width').val(width);

        $('#profile-picture-form')[0].submit();
    })

     // Thank you SO
     function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function(e) {
                console.log(e.target.result);
                $('#profile-picture-show').css('background', `url(${e.target.result})`);
                $('#profile-picture-show').css('background-size', `contain`);
                $('#profile-picture-show').css('background-repeat', `no-repeat`);
                $('#profile-picture-show').css('background-position', `50% 50%`);
            }

            reader.readAsDataURL(input.files[0]);

        }
    }

    $("#profile-picture").change(function(){
        var filepath = $(this).val();
        filepath = filepath.split("\\").slice(-1)[0];
        $("#profile-picture-placeholder").val(filepath);
        
        readURL($(this)[0]);
        $("#profile-picture-cropper").css('display', '');
        $("#profile-picture-cropper").css('z-index', '10000');
    })

    $('#profile-cancel').click(function(){
        $("#profile-picture-cropper").css('display', 'none');

    })

    $('#delete-account').click(function(){
        $('#delete-account-form')[0].submit();
    })

</script>